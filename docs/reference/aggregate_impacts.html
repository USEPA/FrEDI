<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Summarize and aggregate impacts from run_fredi() (calculate national totals, average across models, sum impact types, and interpolate between impact year estimates) — aggregate_impacts • FrEDI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarize and aggregate impacts from run_fredi() (calculate national totals, average across models, sum impact types, and interpolate between impact year estimates) — aggregate_impacts"><meta name="description" content="Summarize and aggregate impacts from run_fredi() (calculate national totals, average across models, sum impact types, and interpolate between impact estimate years)."><meta property="og:description" content="Summarize and aggregate impacts from run_fredi() (calculate national totals, average across models, sum impact types, and interpolate between impact estimate years)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FrEDI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">5.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started"><li><a class="dropdown-item" href="../articles/About.html">About FrEDI</a></li>
    <li><a class="dropdown-item" href="../articles/manual.html">Installing &amp; Running FrEDI</a></li>
    <li><a class="dropdown-item" href="../articles/contributing.html">Contributing to FrEDI</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/References.html">Documentation</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="../articles/Example1.html">Example #1: Run FrEDI with default parameters</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../../documentation/Technical_Documentation_for_FrEDI.pdf">Technical Documentation (TD)</a></li>
<li class="nav-item"><a class="nav-link" href="../../documentation/Technical_Documentation_FrEDI_Appendices.pdf">TD Appendix</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/FrEDI"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Summarize and aggregate impacts from <code><a href="run_fredi.html">run_fredi()</a></code> (calculate national totals, average across models, sum impact types, and interpolate between impact year estimates)</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/FrEDI/blob/HEAD/R/aggregate_impacts.R" class="external-link"><code>R/aggregate_impacts.R</code></a></small>
      <div class="d-none name"><code>aggregate_impacts.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Summarize and aggregate impacts from <code><a href="run_fredi.html">run_fredi()</a></code> (calculate national totals, average across models, sum impact types, and interpolate between impact estimate years).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aggregate_impacts</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">conn</span>,</span>
<span>  aggLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"national"</span>, <span class="st">"modelaverage"</span>, <span class="st">"impacttype"</span>, <span class="st">"impactyear"</span><span class="op">)</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"physical_impacts"</span>, <span class="st">"annual_impacts"</span><span class="op">)</span>,</span>
<span>  groupByCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sector"</span>, <span class="st">"variant"</span>, <span class="st">"impactType"</span>, <span class="st">"impactYear"</span><span class="op">)</span>, <span class="st">"region"</span>,</span>
<span>    <span class="st">"state"</span>, <span class="st">"postal"</span><span class="op">)</span>, <span class="st">"model_type"</span>, <span class="st">"model"</span><span class="op">)</span>, <span class="st">"includeaggregate"</span>, <span class="st">"sectorprimary"</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame of results FrEDI (outputs from <code><a href="run_fredi.html">run_fredi()</a></code>)</p></dd>


<dt id="arg-agglevels">aggLevels<a class="anchor" aria-label="anchor" href="#arg-agglevels"></a></dt>
<dd><p>Levels of aggregation at which to summarize data: one or more of <code>c("national", "modelAverage", "impactYear", "impactType", "all" )</code>. Defaults to all levels (i.e., <code>aggLevels = "all"</code>). Note that, if <code>"impacttype"</code> is in <code>aggLevels</code> (e.g., <code>aggLevels = "all"</code>), column <code>"physical_measure"</code> is dropped from the <code>groupByCols</code> and column <code>"physical_impacts"</code> is dropped from <code>columns</code>. This is because aggregating over impact types for some sectors requires summing costs over different types of physical impacts, so reporting the physical impacts would be nonsensical.</p></dd>


<dt id="arg-columns">columns<a class="anchor" aria-label="anchor" href="#arg-columns"></a></dt>
<dd><p>Character vector of columns for which to aggregate results (defaults to <code>columns = c( "physical_impacts", "annual_impacts")</code>).</p></dd>


<dt id="arg-groupbycols">groupByCols<a class="anchor" aria-label="anchor" href="#arg-groupbycols"></a></dt>
<dd><p>Character vector indicating which columns to use for grouping. Defaults to <code>groupByCols = c("sector", "variant", "impactYear", "impactType", "model_type", "model", "sectorprimary", "includeaggregate", "physicalmeasure", "region", "state", "postal")</code>. Note that the <code>"variant"</code> column referred to below contains information about the variant or adaptation name (or <code>“N/A”</code>), as applicable.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function can be used to aggregate and summarize the FrEDI results to levels of aggregation specified by the user (passed to <code>aggLevels</code>). Users can specify all aggregation levels at once by specifying <code>aggLevels = "all"</code> (default) or no aggregation levels (<code>aggLevels = "none"</code>). Users can specify a single aggregation level or multiple aggregation levels by passing a single character string or character vector to <code>aggLevels</code>. Options for aggregation include calculating national totals (<code>aggLevels= "national"</code>), averaging across model types and models (<code>aggLevels = "modelAverage"</code>), summing over all impact types (<code>aggLevels = "impactType"</code>), and interpolating between impact year estimates (<code>aggLevels = "impactYear"</code>).</p>
<p>Before aggregating impacts for national totals and/or model averages, <code>aggregate_impacts()</code> will drop any pre-summarized results (i.e., values for which <code>region = "National Total"</code> and/or for which <code>model = "Average"</code>, respectively) that are already present in the data and then re-summarize results at those respective levels.</p>
<p>If users specify <code>aggLevels = "none"</code>, <code>aggregate_impacts()</code> returns the data frame passed to the <code>data</code> argument.</p>
<p>If users specify <code>aggLevels = "all"</code> or other combinations of aggregation levels, the <code>aggregate_impacts()</code> function uses performs the following calculations using the grouping columns specified by the <code>groupByCols</code> argument: <code>"sector"</code>, <code>"variant"</code>, <code>"impactType"</code>, <code>"impactYear"</code>, <code>"region"</code>, <code>"state"</code>, <code>"postal"</code>, <code>"model_type"</code>, <code>"model"</code>, <code>"sectorprimary"</code>, <code>"includeaggregate"</code>, <code>"physicalmeasure"</code>, and <code>"year"</code>.</p>
<table class="table table"><tr><td><strong>Aggregation Level</strong></td><td><strong>Description</strong></td></tr><tr><td><em><code>impactyear</code></em></td><td>To aggregate over impact years, <code>aggregate_impacts()</code> first separates results for sectors with only one impact year estimate (i.e., <code>impactYear = "N/A"</code>) from from observations with multiple impact year estimates (i.e., sectors with results for both <code>impactYear = "2010"</code> and <code>impactYear = "2090"</code>). For these sectors with multiple impact years, physical impacts and annual costs (columns <code>"physical_impacts"</code> and <code>"annual_impacts"</code>) are linearly interpolated between impact year estimates. For any model run years above 2090, annual results for sectors with multiple impact years return the 2090 estimate. The interpolated values are then row-bound to the results for sectors with a single impact year estimate, and column <code>impactYear</code> set to <code>impactYear = "Interpolation"</code> for all values. If <code>"impactyear"</code> is included in <code>aggLevels</code> (e.g., <code>aggLevels = "all"</code>), <code>aggregate_impacts()</code> aggregates over impact years before performing other types of aggregation.</td></tr><tr><td><em><code>modelaverage</code></em></td><td>To aggregate over models for temperature-driven sectors, <code>aggregate_impacts()</code> averages physical impacts and annual costs (columns <code>"physical_impacts"</code> and <code>"annual_impacts"</code>, respectively) across all GCM models present in the data. <code>aggregate_impacts()</code> drops the column <code>"model"</code> from the grouping columns when averaging over models. Averages exclude observations with missing values. However, If all values within a grouping are missing, the model average is set to <code>NA</code>. The values in column <code>"model"</code> are set to <code>"Average"</code> for model averages and the model averages data frame is then row-bound to the main results data frame. For SLR-driven sectors, there is no need for additional model aggregation; these values already have <code>model = "Interpolation"</code>. If <code>"modelaverage"</code> is included in <code>aggLevels</code> (e.g., <code>aggLevels = "all"</code>), <code>aggregate_impacts()</code> first aggregates over impact years  (if <code>"impactyear"</code> present in <code>aggLevels</code> or if <code>aggLevels = "all"</code>) before aggregating over models.</td></tr><tr><td><em><code>national</code></em></td><td>To aggregate values to the national level, <code>aggregate_impacts()</code> sums physical impacts and annual costs (columns <code>"physical_impacts"</code> and <code>"annual_impacts"</code>, respectively) across all states present in the data. <code>aggregate_impacts()</code> drops the columns <code>"region"</code>, <code>"state"</code>, and <code>"postal"</code> when summing over states and regions. Years which have missing column data for all states return as <code>NA</code>. Values for columns <code>"region"</code>, <code>"state"</code>, and <code>"postal"</code> are set to <code>"National Total"</code>, <code>All</code>, and <code>US</code>, respectively. The data frame with national totals is then row-bound to the main results data frame. If <code>"national"</code> is included in <code>aggLevels</code> (e.g., <code>aggLevels = "all"</code>), <code>aggregate_impacts()</code> first aggregates over impact years and/or models (if <code>"impactyear"</code> and/or <code>"modelaverage"</code> are present in <code>aggLevels</code> or if <code>aggLevels = "all"</code>) before aggregating over models.</td></tr><tr><td><em><code>impacttype</code></em></td><td>To aggregate values over impact types, <code>aggregate_impacts()</code> sums annual impacts (column <code>"annual_impacts"</code>) across all impact types for each sector. <code>aggregate_impacts()</code> drops the column <code>"impactType"</code> and <code>"physicalmeasure"</code> from the grouping columns when summing over impact types. Years which have missing column data for all impact types return as <code>NA</code>. All values in column <code>"impactType"</code> are set to <code>"all"</code>. Aggregating over impact types, drops columns related to physical impacts (i.e., columns <code>"physicalmeasure"</code> and <code>"physical_impacts"</code>). These columns are dropped since aggregating over impact types for some sectors requires summing costs over different types of physical impacts, so reporting the physical impacts would be nonsensical.</td></tr></table><p>After aggregating values, <code>aggregate_impacts()</code> joins the data frame of impacts with information about <code>"driverType"</code>, <code>"driverUnit"</code>, <code>"driverValue"</code>, <code>"gdp_usd"</code>, <code>"national_pop"</code>, <code>"gdp_percap"</code>, and <code>"state_pop"</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Environmental Protection Agency (EPA). 2021. Technical Documentation on The Framework for Evaluating Damages and Impacts (FrEDI). Technical Report EPA 430-R-21-004, EPA, Washington, DC. Available at <a href="https://epa.gov/cira/FrEDI/" class="external-link">https://epa.gov/cira/FrEDI/</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### Create temperature binning scenario</span></span></span>
<span class="r-in"><span><span class="va">df_results1</span> <span class="op">&lt;-</span> <span class="fu"><a href="run_fredi.html">run_fredi</a></span><span class="op">(</span>aggLevels<span class="op">=</span><span class="st">"none"</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking scenarios...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating impacts...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 		Formatting initial results...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 		Calculating temperature-driven scaled impacts...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 		Calculating SLR-driven scaled impacts...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Formatting results...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Aggregate temperature binning summary across multiple columns</span></span></span>
<span class="r-in"><span><span class="va">df_results2</span> <span class="op">&lt;-</span> <span class="va">df_results1</span> <span class="op">|&gt;</span> <span class="fu">aggregate_impacts</span><span class="op">(</span>columns<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"annual_impacts"</span><span class="op">)</span>, aggLevels<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'conn' in selecting a method for function 'dbReadTable': argument "conn" is missing, with no default</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Corinne Hartin, Erin McDuffie, Marcus Sarofim, Karen Noiva, Tony Gardella.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3. | August 2024</p>
</div>

    </footer></div>





  </body></html>

